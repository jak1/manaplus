# appimage package
dir=`pwd` # current dir
appdir="AppDir" # AppDir

wget "https://gitlab.com/mana-launcher/mplusbuilder/-/raw/master/linuxdeploy-x86_64.AppImage"

chmod +x linuxdeploy-x86_64.AppImage

./linuxdeploy-x86_64.AppImage --appimage-extract

if [ ! -d "$appdir" ]; then
  mkdir "$appdir"
fi

cp -r "$dir/run/share/games/manaplus/data" "$appdir/data"

echo -e '#!/bin/bash
# this file is generated by "build/makeImg.sh" -- all changes get overwriten --
cd $APPDIR
$APPDIR/usr/bin/manaplus $@' > AppDir/AppRun

chmod -R 755 "$dir/$appdir"

./squashfs-root/AppRun --appdir "$appdir" \
-d manaplus.desktop \
-i data/icons/manaplus.svg \
-e run/bin/manaplus \
--output appimage >> logs/appimg.log || exit 1

mv ManaPlus*.AppImage binarys/ || exit 1

exit 0
